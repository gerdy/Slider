/*! slider - v1.0 - 2013-10-23 11:32:40 PM
* Copyright (c) 2013 jixiangac; Licensed  */
KISSY.add("gallery/slider/1.0/index",function(a){"use strict";function b(a){var c=this;b.superclass.constructor.call(c,a),c.init()}var c=a.DOM,d=a.Event;return a.extend(b,a.Base),a.augment(b,{init:function(){function b(a){var b=a?c.vals:c.vals[0];b<c.get("min")&&(b=c.get("min")),b>c.get("max")&&(b=c.get("max")),c.set("values",[0,b]),c.single=!0,c.vals=c.get("values")}var c=this;if(this.el=this.get("element"),(!c.get("min")||c.get("min")<0)&&c.set("min",0),(!c.get("max")||c.get("max")>100)&&c.set("max",100),this.vals=this.get("values"),a.isArray(this.vals)){if(this.vals.length>2){var d=new Error;throw d.name="\u53c2\u6570values\u51fa\u9519",d.message="values\u6570\u7ec4\u957f\u5ea6\u6700\u591a\u4e24\u4f4d",d}1===this.vals.length?b():(this.vals.sort(function(a,b){return a-b}),this.vals[0]<this.get("min")&&(this.vals[0]=this.get("min")),this.vals[1]>this.get("max")&&(this.vals[1]=this.get("max")))}else b(!0);this.render()},render:function(){var b=this,e=b.get("values"),f=(b.get("min"),c.children("a",b.el)),g="<a class='ui-slider-handle ui-state-default'></a>",h=[];c.addClass(b.el,"ui-slider ui-slider-horizontal"),b.range=c.create("<div></div>",{css:{width:Math.abs(e[1]-e[0])+"%",left:e[0]+"%"}}),b.range.className="ui-slider-range",c.append(b.range,b.el);for(var i=f.length,j=e.length;j>i;i++)if(!b.single||0!==i){var k=c.create(g,{css:{left:e[i]+"%"}});c.append(k,b.el),h.push(k)}b.handlers=h,a.each(b.handlers,function(a,c){d.on(a,"mousedown",function(d){b.clickTarget=a,b.clickIndex=c,b._mouseDown(d)})}),d.on(document,"mousemove",function(a){b.tickDrag&&b._mouseDrag(a)}),d.on(document,"mouseup",function(a){b._mouseUp(a)})},_mouseDown:function(a){var b=this,c=1===a.which;return c&&b._mouseCapture(a)?(b.tickDrag=!0,a.halt(),void 0):!1},_mouseUp:function(a){var b=this,c=!!b.clickTarget;b._stop(a),b.tickDrag=!1,b.clickTarget=null,b.clickIndex=null,c&&this.fire("stop")},_mouseCapture:function(a){var b,d,e,f,g=this,h=this.get("min");return this.get("max"),g.get("values"),g.elSize={width:c.outerWidth(g.el,!0),height:c.outerHeight(g.el,!0)},g.elOffset=c.offset(g.el),b={x:a.pageX,y:a.pageY},d=g._normValueFromMouse(b),f=g.values(0)!==g.values(1)||g.single?g.clickIndex:d>g.values(0)?1:d<g.values(1)?0:g._last_index,g.single||g.values(1)!==h||(f=1),e=g.handlers[f],g._last_index=f,c.addClass(e,"ui-state-active"),g._cacheStopPostion=g.single?g.values(1):g.values(0===f?1:0),g._clickOffset={left:a.pageX-c.offset(e).left-c.width(e)/2},!0},_mouseDrag:function(a){var b,c=this;if(!c.tickDrag||null===c.clickTarget)return!1;b=c._normValueFromMouse({x:a.pageX,y:a.pageY}),c.single?c._change(null,1,b):c._change(null,c.clickIndex,b);var d=c.clickIndex;if(b<c.values(0))c.clickIndex=0,c._change(null,1,c.values(0)),c._stop(a,c.clickIndex);else if(b>c.values(1)){var e=0;c.single?e=1:c.clickIndex=1,c._change(null,e,c.values(1)),c._stop(a,c.clickIndex)}return c._slide(a,d,b),!1},_stop:function(a,b){c.removeClass(this.handlers,"ui-state-active"),arguments.length>1&&!this.single&&c.addClass(this.handlers[b],"ui-state-active")},_slide:function(a,b){var d,e=this;if(e.single)return d=e.values(1),c.css(e.range,{width:Math.abs(d)+"%",left:0}),c.css(e.handlers[0],"left",d+"%"),void 0;var f=e.values(b),g=e._cacheStopPostion;return"set"===a&&(f=e.values(0),g=e.values(1)),d=g-f,c.css(e.range,{width:Math.abs(d)+"%",left:this.values(0)+"%"}),"set"===a?(c.css(e.handlers[0],"left",f+"%"),c.css(e.handlers[1],"left",g+"%"),void 0):(c.css(e.handlers[b],"left",e.values(b)+"%"),c.css(e.handlers[0===b?1:0],"left",e._cacheStopPostion+"%"),void 0)},values:function(a,b){this.get("values");var c=this;return arguments.length>1?(c._change(null,a,b),void 0):arguments.length?c._values(a):void 0},_values:function(a){var b=this.get("values");return this._trimAlignValue(b[a])},getValues:function(){var a=this.get("values");return this.single?a[1]:a},setValues:function(b,c){var d=this,e=this.get("values");if(a.isArray(arguments[0]))return e=arguments[0],this.set("values",e,!0),this._slide("set",0,e[0]),this._slide("set",1,e[1]),void 0;if(1===arguments.length&&this.single)e[1]=parseInt(arguments[0],10),this._slide(null,1,e[1]);else{if(c=parseInt(c,10)||0,0==b&&c>e[1]||1==b&&c<e[0])return;1==b&&c>d.get("max")&&(c=100),0==b&&c<d.get("min")&&(c=0),e[b]=c,this._slide("set",b,e[b])}this.set("values",e,!0)},_change:function(a,b,c){var d=this.get("values");arguments.length>2&&(d[b]=c),this.set("values",d,!0),this.fire("change",{index:b,val:c})},_normValueFromMouse:function(a){var b,c,d,e,f,g=this.get("min"),h=this.get("max"),i=this;return b=i.elSize.width,c=a.x-i.elOffset.left-(i._clickOffset?i._clickOffset.left:0),d=c/b,d>1&&(d=1),0>d&&(d=0),e=h-g,f=g+d*e,i._trimAlignValue(f)},_trimAlignValue:function(a){var b=this.get("min"),c=this.get("max"),d=this.get("step");if(b>=a)return b;if(a>=c)return c;d=d>0?d:1;var e=(a-b)%d,f=a-e;return 2*Math.abs(e)>=d&&(f+=e>0?d:-d),parseFloat(f.toFixed(5))}}),b},{requires:["node","base"]});